# Instalar e validar **Erlang 27.x (compatível com RabbitMQ 4.x)** no RHEL 9 (air-gapped)

## 0) Pré-requisitos
- Usuário com `sudo`.
- Ambiente RHEL 9 (Enterprise Linux 9).
- Porta de upload de arquivos acessível via SCP/SFTP (MobaXterm ou similar).

---

## 1) No Windows (PowerShell) — baixar arquivos

Crie/entre na pasta de staging:
```powershell
cd C:\erlang-rhel9-offline
```

Baixe o pacote do **Erlang 27.3.4.2 (zero-dependency, EL9, x86_64)**:
```powershell
curl.exe -o erlang-27.3.4.2-1.el9.x86_64.rpm "https://github.com/rabbitmq/erlang-rpm/releases/download/v27.3.4.2/erlang-27.3.4.2-1.el9.x86_64.rpm"
```

(Se seu servidor for **ARM/aarch64**, baixe o arquivo correspondente da mesma release do repositório `rabbitmq/erlang-rpm`).

Confirme o tamanho (~25 MB):
```powershell
Get-Item .\erlang-27.3.4.2-1.el9.x86_64.rpm | Select-Object Length
```

---

## 2) Upload para a VM

- **Painel SFTP (drag-and-drop)** → para `/tmp`  
- ou **SCP no PowerShell**:
```powershell
scp C:\erlang-rhel9-offline\erlang-27.3.4.2-1.el9.x86_64.rpm usuario@IP_DO_SERVIDOR:/tmp/
```

⚠️ **Ponto de atenção — 2FA**: cada upload pode abrir **sub-sessão** → aprove no app **2FA** sempre que solicitado.

---

## 3) Instalar na VM (offline)

### 3.1 Remover Erlang existente (se já houver)
```bash
rpm -qa | grep -i erlang
sudo dnf remove -y erlang
```

### 3.2 Instalar Erlang 27.x
```bash
cd /tmp
sudo dnf localinstall -y erlang-27.3.4.2-1.el9.x86_64.rpm
```

---

## 4) Validar a instalação

### 4.1 Checar versão
```bash
erl -version
```

### 4.2 Checar OTP release
```bash
erl -noshell -eval 'io:format("~s~n",[erlang:system_info(otp_release)]), halt().'
```
Saída esperada: `27`

### 4.3 Metadados do pacote
```bash
rpm -qi erlang
```

---

## 5) Teste rápido — Hello World em Erlang

```bash
cat > hello.erl <<'EOF'
-module(hello).
-export([start/0]).

start() ->
    io:format("Hello, world!~n").
EOF

erlc hello.erl
erl -noshell -eval 'hello:start(), halt().'
```
Saída esperada:
```
Hello, world!
```

---

## 6) Troubleshooting rápido
- **Arquivo inválido** → confira com `file erlang-27*.rpm` se é RPM válido.  
- **Dependências quebradas** → baixe o pacote correto da release `rabbitmq/erlang-rpm` (zero-dependency).  
- **Versão incorreta** → rode `erl -noshell -eval 'io:format("~s~n",[erlang:system_info(otp_release)]), halt().'` para confirmar que está em `27`.  
