# Instalar e validar **Erlang** no RHEL 9 (air-gapped)

## 0) Conferências rápidas na VM
```bash
uname -m                 # ex.: x86_64 ou aarch64
cat /etc/redhat-release  # confirmar RHEL 9.x
```
> Requer usuário com `sudo`.

---

## 1) No Windows (PowerShell) — baixar arquivos
Crie a pasta e baixe **chaves** e **RPM** (ajuste a versão/arquitetura conforme você escolheu):
```powershell
mkdir C:\erlang-rhel9-offline
cd C:\erlang-rhel9-offline

Invoke-WebRequest -Uri "https://github.com/rabbitmq/signing-keys/releases/download/3.0/rabbitmq-release-signing-key.asc" -OutFile "rabbitmq-release-signing-key.asc"
Invoke-WebRequest -Uri "https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key" -OutFile "cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key"

# Exemplo para x86_64 (ajuste para a sua versão/arquitetura)
Invoke-WebRequest -Uri "https://github.com/rabbitmq/erlang-rpm/releases/download/v28.0.2/erlang-28.0.2-1.el9.x86_64.rpm" -OutFile "erlang-28.0.2-1.el9.x86_64.rpm"

# (Opcional) conferir integridade
Get-FileHash .\erlang-28.0.2-1.el9.x86_64.rpm -Algorithm SHA256
```

---

## 2) Transferir para a VM (MobaXterm / SCP)

### ⚠️ Atenção ao **2FA** nos uploads
- Em ambientes com Duo/Okta/MS Authenticator, **cada upload** pode abrir uma sub-sessão SFTP/SCP → **autorize no app 2FA** a **cada envio**.  
- Sintoma comum: “**UPLOADING 0%**” até você aprovar.  
- Dicas: deixe o app 2FA já aberto; **envie um arquivo por vez**; se travar, reenvie.

**Opção A — Painel SFTP (drag-and-drop)**
- Conecte via SSH e navegue para `/tmp` no painel esquerdo; arraste:
  - `rabbitmq-release-signing-key.asc`
  - `cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key`
  - `erlang-*.el9.*.rpm`

**Opção B — SCP (PowerShell)**
```powershell
scp C:\erlang-rhel9-offline\rabbitmq-release-signing-key.asc usuario@IP_DO_SERVIDOR:/tmp/
scp C:\erlang-rhel9-offline\cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key usuario@IP_DO_SERVIDOR:/tmp/
scp C:\erlang-rhel9-offline\erlang-28.0.2-1.el9.x86_64.rpm usuario@IP_DO_SERVIDOR:/tmp/
```

---

## 3) Instalar na VM (offline)
Entre na pasta:
```bash
cd /tmp
ls -lh
```

### 3.1 Importar as chaves (locais)
```bash
sudo rpm --import rabbitmq-release-signing-key.asc
sudo rpm --import cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key
```

### 3.2 (Opcional) Ver dependências do RPM
```bash
rpm -qpR erlang-*.el9.*.rpm
```
> Se aparecer lib ausente (ex.: `libicu`, `ncurses-libs`, `openssl-libs`, `zlib`), baixe os **RPMs EL9** correspondentes no Windows e traga junto.

### 3.3 Instalar
```bash
sudo dnf localinstall -y erlang-*.el9.*.rpm
# ou, se tiver outras dependências na mesma pasta:
# sudo dnf localinstall -y *.rpm
```

---

## 4) **Validar a instalação**

### 4.1 Versão do runtime
```bash
erl -version
```
> Ex.: `emulator version 16.0.2` (OK).

### 4.2 “Hello, world” (compilar e rodar)
```bash
cat > hello.erl <<'EOF'
-module(hello).
-export([start/0]).

start() ->
    io:format("Hello, world!~n").
EOF

erlc hello.erl
erl -noshell -eval 'hello:start(), halt().'
```
Saída esperada:
```
Hello, world!
```

### 4.3 (Opcional) Serviços auxiliares
```bash
which erl
rpm -qi erlang
epmd -daemon && epmd -names
```

---

## 5) Troubleshooting rápido
- **Upload travado (0%)** → aprove o **2FA** no app; tente SCP por comando.  
- **Dependências faltando** no `localinstall` → use `rpm -qpR` para listar; baixe os **RPMs EL9** necessários e rode `sudo dnf localinstall -y *.rpm`.  
- **Erro de sintaxe ao compilar** → confirme `io:format("...")` (com `:`) e pontos finais nas diretivas/funções:
  ```bash
  nl -ba hello.erl
  ```
