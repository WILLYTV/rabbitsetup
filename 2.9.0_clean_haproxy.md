# 2.9.0 – Limpeza do HAProxy (Remoção Completa)

## Objetivo
Este documento descreve como remover completamente o HAProxy de um node RHEL, restaurando o ambiente para uso exclusivo do RabbitMQ. Útil para cenários em que o HAProxy foi instalado por engano ou não será mais utilizado no node.

---

## 1. Parar e desabilitar o serviço HAProxy
```bash
sudo systemctl stop haproxy
sudo systemctl disable haproxy
```

---

## 2. Remover o pacote HAProxy
```bash
sudo dnf remove haproxy
```
Se houver dependências instaladas junto com o HAProxy, remova-as conforme necessário:
```bash
sudo dnf autoremove
```

---

## 3. Limpar arquivos de configuração
Remova arquivos de configuração personalizados, se existirem:
```bash
sudo rm -f /etc/haproxy/haproxy.cfg
sudo rm -rf /etc/haproxy/
```

---

## 4. Limpar arquivos de log
Remova logs antigos do HAProxy:
```bash
sudo rm -rf /var/log/haproxy/
```

---

## 5. Validar remoção
Verifique se o serviço não existe mais:
```bash
systemctl status haproxy
```
O resultado deve indicar que o serviço não está instalado.

---

## 6. Restaurar RabbitMQ (se necessário)
Se o RabbitMQ estava com portas alteradas para coexistir com o HAProxy, restaure as portas padrão no arquivo de configuração `/etc/rabbitmq/rabbitmq.conf`:

- AMQP:
```
listeners.tcp.default = 5672
```
- Management UI HTTP:
```
management.listener.port = 15672
```
- Management UI HTTPS (TLS):
```
management.listener.ssl.port = 15671
```

Reinicie o RabbitMQ:
```bash
sudo systemctl restart rabbitmq-server
```

---

## 7. Testar funcionamento do RabbitMQ
Verifique se o RabbitMQ está escutando nas portas padrão:
```bash
sudo ss -ltnp | grep rabbitmq
```
Teste conexão das aplicações normalmente.

---

## 8. Observações
- Execute todos os comandos como root ou com sudo.
- Para ambientes offline, não é necessário acesso à internet para remover o HAProxy.
- Documente a remoção para controle de mudanças.

---

> **Dica:** Após a remoção, mantenha backups dos arquivos de configuração caso precise restaurar o HAProxy no futuro.
