# Passo pré-execução: Instalar rabbitmqadmin em todos os nodes

## Download e instalação do rabbitmqadmin


### 1. Em um node do cluster com Management UI ativo (ex: sncpos00901C)
No próprio node, baixe o script:
```bash
curl -o rabbitmqadmin http://localhost:15672/cli/rabbitmqadmin
chmod +x rabbitmqadmin
sudo mv rabbitmqadmin /usr/local/bin/
```


### 2. Transfira o arquivo para os demais nodes
Copie o arquivo rabbitmqadmin (agora em /usr/local/bin/) para os outros nodes do cluster usando SCP/SFTP/MobaXterm, ou baixe diretamente de cada node usando:
```bash
curl -o rabbitmqadmin http://sncpos00901C:15672/cli/rabbitmqadmin
chmod +x rabbitmqadmin
sudo mv rabbitmqadmin /usr/local/bin/
```

> O Management UI precisa estar ativo no node de origem (porta 15672 liberada na rede).

Assim, o comando rabbitmqadmin estará disponível em todos os nodes para os testes.
# Teste de Failover no Cluster RabbitMQ

Siga o roteiro abaixo para validar o funcionamento do failover no cluster:

## 1. Valide o status do cluster
```bash
sudo rabbitmqctl cluster_status
```

## 2. Crie uma fila quorum e publique mensagens
```bash
sudo rabbitmqadmin declare queue name=test_quorum type=quorum durable=true
sudo rabbitmqadmin publish queue=test_quorum payload="Mensagem de teste 1"
sudo rabbitmqadmin publish queue=test_quorum payload="Mensagem de teste 2"
```

## 3. Consuma mensagens da fila
```bash
sudo rabbitmqadmin get queue=test_quorum requeue=false
```

## 4. Identifique o node líder da fila
- No Management UI, veja em “Queues” qual node está como “Leader” da fila test_quorum.

## 5. Simule falha do node líder
- No node líder, pare o serviço RabbitMQ:
```bash
sudo systemctl stop rabbitmq-server
```

## 6. Verifique failover
- No Management UI ou via CLI, veja se outro node assumiu como líder da fila.
- Tente consumir/publish na fila novamente:
```bash
sudo rabbitmqadmin get queue=test_quorum requeue=false
sudo rabbitmqadmin publish queue=test_quorum payload="Mensagem após failover"
```

## 7. Reinicie o node parado
```bash
sudo systemctl start rabbitmq-server
```

## 8. Valide a reintegração do node ao cluster
```bash
sudo rabbitmqctl cluster_status
```

---

> **Dica:** Repita o teste para diferentes nodes e filas. Teste também o comportamento dos clientes conectados durante o failover.
# 2.8 – Testes de Funcionamento

## Criar fila de teste
```bash
sudo rabbitmqadmin declare queue name=test_queue durable=true
```

## Publicar mensagem
```bash
sudo rabbitmqadmin publish routing_key=test_queue payload="hello world"
```

## Consumir mensagem
```bash
sudo rabbitmqadmin get queue=test_queue
```
