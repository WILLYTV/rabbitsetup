# 2.4 – Configuração de Rede e Segurança

## Liberar portas
## se firewall ativo
```bash
sudo ufw allow 5672
sudo ufw allow 15672
```

## Ativar TLS (opcional, recomendado)

### 1. Gerar certificados autoassinados (para testes/lab)
# IMPORTANTE: Ao rodar o comando openssl, quando solicitado o "Common Name (CN)", informe o nome da máquina (hostname ou FQDN) que será usado para acessar o RabbitMQ via HTTPS.
# Exemplo: para acessar https://node00:15671, informe node00 como CN. Para domínio, use o FQDN.
Crie os arquivos diretamente na pasta esperada:
```bash
sudo mkdir -p /etc/rabbitmq/
cd /etc/rabbitmq/
sudo openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out cert.pem
# Para ambiente de teste, use o próprio cert.pem como ca.pem:
sudo cp cert.pem ca.pem
# Ajustar permissões dos arquivos:
sudo chown rabbitmq:rabbitmq /etc/rabbitmq/*.pem
sudo chmod 600 /etc/rabbitmq/*.pem
```

### 2. Editar configuração do RabbitMQ
Se o comando abaixo retornar "command not found", instale o nano com:
```bash
sudo dnf install -y nano
```
Depois edite o arquivo:
```bash
sudo nano /etc/rabbitmq/rabbitmq.conf
```
Adicionar no arquivo:
```conf
# Listeners AMQP
listeners.tcp.default = 5672
listeners.ssl.default = 5671
ssl_options.cacertfile = /etc/rabbitmq/ca.pem
ssl_options.certfile   = /etc/rabbitmq/cert.pem
ssl_options.keyfile    = /etc/rabbitmq/key.pem
ssl_options.verify     = verify_peer
ssl_options.fail_if_no_peer_cert = true

# Management UI
management.tcp.port = 15672
management.ssl.port = 15671
management.ssl.cacertfile = /etc/rabbitmq/ca.pem
management.ssl.certfile   = /etc/rabbitmq/cert.pem
management.ssl.keyfile    = /etc/rabbitmq/key.pem
```

### 3. Reiniciar serviço
```bash
sudo systemctl restart rabbitmq-server
```

---

> **Nota:**
> - Em ambiente corporativo, utilize certificados e CA oficiais fornecidos pela empresa.
> - Para testes, o próprio cert.pem pode ser usado como ca.pem, mas isso não é recomendado para produção.
> - Assegure-se de que os arquivos .pem pertençam ao usuário rabbitmq e tenham permissão restrita (600) para evitar falhas de inicialização.
> - O Common Name (CN) do certificado deve ser igual ao hostname ou FQDN usado no acesso HTTPS.
> - O acesso ao Management UI via HTTPS será feito pela porta 15671 (https://nomedamaquina:15671).
